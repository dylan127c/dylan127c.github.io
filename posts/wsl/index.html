<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WSL | Think</title>
<meta name="keywords" content="Windows Subsystem, Virtual Machine, Linux, Ubuntu">
<meta name="description" content="概述 Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。
WSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：WSL 文档。
虚拟化技术 WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：虚拟化技术。
Linux 发行版 在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：
wsl 控制台将输出与 wsl.exe 程序相关的参数说明：
该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。
Linux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。
Linux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。
微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。
除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。">
<meta name="author" content="dylan">
<link rel="canonical" href="https://dylan127c.github.io/posts/wsl/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.eddf3fb605328bdcc3bebdfcc183268fffbd9d88fb4a11fc74a5362696c5a61c.css" integrity="sha256-7d8/tgUyi9zDvr38wYMmj/&#43;9nYj7ShH8dKU2JpbFphw=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dylan127c.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dylan127c.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dylan127c.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dylan127c.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dylan127c.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="/css/lightgallery.min.css">



<script src="/js/mermaid.min.js"></script>
<script>
    
    const config = {
        startOnLoad: true,
        theme: 'forest',
        themeVariables: {
            lineColor: "#ff8033" 
        },
        flowchart: {
            useMaxWidth: false,
            htmlLabels: true
        }
    };
    
    mermaid.initialize(config);
    
    
    window.onload = () => {
        window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    }
</script><meta property="og:title" content="WSL" />
<meta property="og:description" content="概述 Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。
WSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：WSL 文档。
虚拟化技术 WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：虚拟化技术。
Linux 发行版 在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：
wsl 控制台将输出与 wsl.exe 程序相关的参数说明：
该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。
Linux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。
Linux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。
微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。
除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dylan127c.github.io/posts/wsl/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-23T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WSL"/>
<meta name="twitter:description" content="概述 Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。
WSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：WSL 文档。
虚拟化技术 WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：虚拟化技术。
Linux 发行版 在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：
wsl 控制台将输出与 wsl.exe 程序相关的参数说明：
该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。
Linux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。
Linux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。
微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。
除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://dylan127c.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "WSL",
      "item": "https://dylan127c.github.io/posts/wsl/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WSL",
  "name": "WSL",
  "description": "概述 Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。\nWSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：WSL 文档。\n虚拟化技术 WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：虚拟化技术。\nLinux 发行版 在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：\nwsl 控制台将输出与 wsl.exe 程序相关的参数说明：\n该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。\nLinux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。\nLinux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。\n微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。\n除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。",
  "keywords": [
    "Windows Subsystem", "Virtual Machine", "Linux", "Ubuntu"
  ],
  "articleBody": "概述 Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。\nWSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：WSL 文档。\n虚拟化技术 WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：虚拟化技术。\nLinux 发行版 在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：\nwsl 控制台将输出与 wsl.exe 程序相关的参数说明：\n该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。\nLinux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。\nLinux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。\n微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。\n除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。\n可以将 Linux 发行版看作 Linux 系统的子集，或者说 Linux 发行版是 Linux 系统的具体解释。例如 CentOS 是 Linux 发行版，但同时它也是 Linux 系统。因此，从某种意义上来说，可将 Linux 发行版与 Linux 系统看作是同一个东西。\n更多关于 Linux 发行版的资料，请参考：Linux Distribution - WIKI。\n关于终端命令 后续涉及诸多 Windows PowerShell 命令，其中有一点注意事项，即为终端命令选项提供的参数，一般不能书写空格符号的。\n如果参数包含空格符号，则需要用单引号或双引号将其包裹，或将空格符号转义。\n假如在 H:\\ 盘下拥有一个名为 proxy rules 的目录，以下演示不同命令进入该目录的方法。\nCMD 命令书写如下（命令顺序不重要，但盘符切换不能使用 cd 命令）：\nh: cd \"proxy rules\" PowerShell 命令书写如下：\ncd 'h:\\proxy rules' Bash 命令书写如下：\ncd /h/proxy\\ rules ####### OR ####### cd '/h/proxy rulse' 以上使用单引号的命令同时兼容使用双引号，但使用双引号的命令不兼容使用单引号。其次，对于不包含空格符号的参数来说，单引号或双引号可省略不写。\n例如以下命令：\nwsl --install --distribution Ubuntu 等价以下命令：\nwsl --install --distribution 'Ubuntu' 如果是为了养成良好的编程习惯，那么不省略单引号或双引号是更好的方案。\nWSL 对于大多数 Windows 10 或以上版本的系统来说，它们都已经默认支持 WSL 了，可以通过区分系统版本，来判断目前系统支持的 WSL 版本有什么。\n不同版本的 WSL 并不是非此即彼的存在，同一个 Windows 系统可同时兼容 WLS 1 和 WSL2。\n功能 WSL 1 WSL 2 Windows 和 Linux 之间的集成 ✅ ✅ 启动时间短 ✅ ✅ 与传统虚拟机相比，占用的资源量少 ✅ ✅ 可以与当前版本的 VMware 和 VirtualBox 一起运行 ✅ ✅ 托管 VM ❌ ✅ 完整的 Linux 内核 ❌ ✅ 完全的系统调用兼容性 ❌ ✅ 跨 OS 文件系统的性能 ✅ ❌ WSL 目前仅有 WSL1 和 WSL2 两个版本，就性能表现上推荐使用 WSL2。如果 Windows 系统版本号低于 18917 则表示当前系统只支持 WSL1，如果高于 18917 则表示系统同时支持 WSL1 和 WSL2。\n查看系统版本信息，需要打开命令提示符 CMD 程序运行以下命令：\nver 使用 Windows PowerShell 则运行以下命令：\ncmd 'ver' 当前系统的版本信息会输出在控制台中：\n上述例子中，版本号为 22621 就表示当前系统同时支持 WSL1 和 WSL2。\nWSL 程序默认存储在 C:\\Windows\\System32 目录中：\n该程序的企鹅图标即为 Linux 的典型标志。\n虽然 WSL 程序已存在于系统中，但实际尚未可用，直接调用往往只能看到一个一闪而过的终端窗口。\n因为调用 wsl.exe 程序时，它需要间接启动当前默认的 Linux 发行版，显然系统尚未安装任何的 Linux 发行版，这意味着现在调用 wsl.exe 程序毫无用处。\n一种更为浅显的理解，可以把 WSL 看作连接 Windows 系统和 Linux 系统的桥梁，即使用 WSL 可以在 Windows 上建立与 Linux 系统的高效连接。\n显然，目前 Windows 系统和 WSL 程序都已准备妥当，唯一缺失的仅有 Linux 系统。\n使用 WSL2 版本 安装 Linux 发行版前，需要确认安装发行版时所使用的 WSL 版本是什么。由于 WSL2 相较于 WSL1 拥有更好的虚拟性能，因此建议后续安装的 Linux 发行版均使用 WSL2。\n遗憾的是，即便能够通过查询系统版本号的方式，确认系统是否支持 WSL2，但这却并不意味着支持 WSL2 的系统默认使用的 WSL 版本为 WSL2！\n在无安装任何 Linux 发行版的情况下，WSL 亦无提供任何用于查询当前 WSL 版本的命令。因此推荐显式地运行设置版本为 WSL2 的命令，以确保后续安装的 Linux 发行版均使用 WSL2。\n以下命令可以确保后续安装的 Linux 发行版均使用 WSL2：\nwsl --set-default-version '2' 该命令只需要运行一次，后续默认安装或新安装的 Linux 发行版都会使用 WSL2。\n安装 Linux 发行版 官方所说的“安装 WSL”并平常所理解安装，与其说“安装 WSL”倒不如说是“将指定的 Linux 发行版安装到本地”。一旦本地安装了 Linux 发行版，就能通过 WSL 访问并使用它。\n以下命令会将默认的 Linux 发行版安装到本地：\nwsl --install 该命令实际等同于：\nwsl --install --distribution 'Ubuntu' 从命令的形式看，可以知道“默认的 Linux 发行版”就是“Ubuntu”发行版。通过修改 –distribution 选项的参数，可以安装其他的 Linux 发行版。\n但 WSL 并非支持任意的 Linux 发行版，想要获取所有受支持的 Linux 发行版列表，需要使用命令行在线查询获取。\n以下命令用于查询所有 WSL 支持安装的 Linux 发行版列表：\nwsl --list --online 需要注意，该命令本质是从网络上拉取列表。如果网络不佳，则可能出现错误提示：\n其中 NAME 即为 --distribution 选项所能接受的参数，FRIDENDLY NAME 则为更加详解的版本名称，能够在列表中看到默认安装的“Ubuntu”发行版。\n如果不希望使用默认的 Ubuntu 发行版，可以在安装时使用 --distrubution 或 -d 选项指定发行版的名称。例如安装 Ubuntu-22.04 发行版：\nwsl --install -d 'Ubuntu-22.04' 这个命令同时使用于安装其他的 Linux 发行版，这样可以将多个不同的 Linux 发行版安装到本地。\n查看 Linux 发行版 以下命令用于查看所有已安装 Linux 发行版的信息：\nNAME 表示 Linux 发行版名称； STATE 表示 Linux 发行版所处状态； VERSION 表示 Linux 发行版使用的 WSL 版本。 wsl --list --verbose 默认 Linux 发行版 查看 Linux 发行版信息时，不难留意到位于行首的 * 标志。它表示当前调用 wsl.exe 程序时，默认使用的 Linux 发行版是什么。\n例如上述例子中，默认的 Linux 发行版为 Ubuntu-22.04，这意味着调用 wsl.exe 程序时，就会启动并使用 Ubuntu-22.04 发行版。\n进入 wsl.exe 程序后，运行以下命令可以查询 Ubuntu 系统的版本号：\nlsb_release -a 回到 PowerShell 中运行以下命令，可以更改默认启动的 Linux 发行版：\nwsl --set-default 在上述例子中，需要运行命令：\nwsl --set-default 'Ubuntu-20.04' 再次调用 wsl.exe 打开 Linux Bash 终端，并查询 Ubuntu 版本信息：\n可以看到发行版信息已改变，这意味着默认使用的 Linux 发行版确实改变了。\n更改 WSL 版本 如果一开始并没有配置 WSL 默认版本，即没有运行以下命令：\nwsl --set-default-version '2' 那么查看当前所有已安装的 Linux 发行版时，就可能出现 VERSION 为 1 的情况：\n示例中 Ubuntu-22.04 发行版使用的 WSL 版本为 WSL1，所幸这并非无可挽救。\n以下命令用于更改当前已安装 Linux 发行版所使用 WSL 版本：\nwsl --set-version 在上述例子中，需要运行命令：\nwsl --set-version 'Ubuntu-22.04' '2' WSL 版本的转换需要一定的时间：\n转换完毕后，可查看到对应 Linux 发行版所使用的 WSL 版本已变更：\n备份 Linux 发行版 使用虚拟系统的最大优点，莫过于系统的可恢复性了。WSL 提供了方便的导入/导出发行版系统的命令，可随时将 Linux 发行版导出为 .tar 文件，或将 .tar 文件恢复成 Linux 发行版。\n以下命令用于导出 Linux 发行版：\nwsl --export 以下命令用于导入 Linux 发行版：\nwsl --import 以 Ubuntu-22.04 为例，需要将它导出至系统磁盘，则运行以下命令：\nwsl --export 'Ubuntu-22.04' 'C:\\Ubuntu-22.04.tar' 后续需要将 Ubuntu-22.04 重新导入 WSL 中，则运行以下命令：\nwsl --import 'My-Ubuntu' 'I:\\Virtual Machine' 'C:\\Ubuntu-22.04.tar' 导入的 Linux 发行版会以导入时指定的发行版名称，出现在当前已安装的发行版列表中：\n卸载 Linux 发行版 假如不再需要使用某个 Linux 发行版，或需要删除当前的 Linux 发行版重新安装或导入其他的同名的发行版时，就需要使用到卸载或注销 Linux 发行版的命令。\n以下命令用于卸载或注销指定名称的 Linux 发行版：\nwsl --unregister 以 My-Ubuntu 发行版为例，卸载它需要运行命令：\nwsl --unregister 'My-Ubuntu' 卸载或注销操作会一并将相关的文件删除，不用担心文件冗余的情况。\n其他 WSL 操作 以下命令用于更新 WSL：\nwsl --update 该命令有一个可选的 --web-download 选项，使用它表示更新会从 GitHub 下载，而不从 Microsoft Store 下载。\n以下命令用于关闭 WSL：\nwsl --shutdown 该命令会立即终止所有正在运行的发行版和 WSL 2 轻量级实用工具虚拟机。\n如果只需要终止指定的发行版或阻止其运行，可以使用以下命令：\nwsl --terminate 例如终止 Ubuntu-20.04 发行版的运行：\nwsl --terminate 'Ubuntu-20.04' 实际上，退出 Linux Bash 之后对应的 Linux 发行版会自动停止运行。不过存在一种特殊的方法，使用该方法能让 Linux 发行版保存运行状态，并随系统启动而自动运行。\n访问 Linux 文件 如果要从 Windows 访问 Linux 文件，可通过路径访问：\n\\\\wsl$\\ 以 Ubuntu-20.04 为例，需要访问 Linux 系统文件，则访问以下路径即可：\n\\\\wsl$\\Ubuntu-20.04 Linux 发行版的虚拟驱动器通常名为 ext4.vhdx 且被存储在 AppData 内相关的 WSL 目录中，这种虚拟驱动器通常可以被挂载。\n不过官方不建议使用任何 Windows 工具或编辑器修改、移动或访问 AppData 目录中的 WSL 相关文件。使用路径访问 Linux 文件的方式，是官方所推荐的唯一访问形式。\n但该形式存在一个问题，Linux 发行版在不使用时总是处于 Stopped 状态：\n如果目标发行版处于 Stopped 状态，那么访问该发行版的系统文件时，WSL 需先将该发行版启动，随后 Windows 系统才能到发行版文件。\n换言之，如果目标 Linux 发行版尚未启动，那么直接访问目标 Linux 文件就会出现卡顿的情况。\n自启 Linux 发行版 WSL 实则并未提供任何让 Linux 发行版随开机启动的放，但可以利用 Windows 系统访问 Linux 系统文件的特点，间接让指定的 Linux 发行版随开机启动。\n将访问指定 Linux 发行版系统文件的链接，映射为网络驱动器：\n添加完毕后，电脑中会出现该 Linux 发行版的网络位置：\n使用命令行查看所有已安装 Linux 发行版的状态：\nwsl --list --verbose 将看到 Ubuntu-22.04 发行版会一直处于 Running 状态。\n由于重启计算机后，网络位置也会重新连接，则对应的 Linux 发行版需要启动后网络位置才能完成重新连接，自此间接达成了自启 Linux 发行版的目的。\n修改 root 密码 默认情况下，安装 Linux 发行版后，系统内默认的 root 密码是随机的，这意味着每次开机都会有一个新的 root 密码。为便于使用，需要变更发行版 root 用户的密码为固定的。\n进入 Linux Bash 中使用以下命令修改当前用于的密码：\nsudo passwd 修改完毕后，该密码即会作为 root 用户的新密码。\n将用户切换为 root 使用以下命令：\nsu root 显示当前用户名称，使用以下命令：\nwhoami 测试 root 用户密码的可用性：\n显然 root 用户密码已成功变更。\n",
  "wordCount" : "739",
  "inLanguage": "en",
  "datePublished": "2023-04-23T00:00:00Z",
  "dateModified": "2023-04-23T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "dylan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dylan127c.github.io/posts/wsl/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Think",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dylan127c.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dylan127c.github.io/" accesskey="h" title="Think (Alt + H)">Think</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://dylan127c.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://dylan127c.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://dylan127c.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://dylan127c.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://dylan127c.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://dylan127c.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      WSL
    </h1>
    <div class="post-meta"><span title='2023-04-23 00:00:00 +0000 UTC'>April 23, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;dylan

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a6%82%e8%bf%b0" aria-label="概述">概述</a></li>
                <li>
                    <a href="#%e8%99%9a%e6%8b%9f%e5%8c%96%e6%8a%80%e6%9c%af" aria-label="虚拟化技术">虚拟化技术</a></li>
                <li>
                    <a href="#linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="Linux 发行版">Linux 发行版</a></li>
                <li>
                    <a href="#%e5%85%b3%e4%ba%8e%e7%bb%88%e7%ab%af%e5%91%bd%e4%bb%a4" aria-label="关于终端命令">关于终端命令</a></li>
                <li>
                    <a href="#wsl" aria-label="WSL">WSL</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-wsl2-%e7%89%88%e6%9c%ac" aria-label="使用 WSL2 版本">使用 WSL2 版本</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="安装 Linux 发行版">安装 Linux 发行版</a></li>
                <li>
                    <a href="#%e6%9f%a5%e7%9c%8b-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="查看 Linux 发行版">查看 Linux 发行版</a></li>
                <li>
                    <a href="#%e9%bb%98%e8%ae%a4-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="默认 Linux 发行版">默认 Linux 发行版</a></li>
                <li>
                    <a href="#%e6%9b%b4%e6%94%b9-wsl-%e7%89%88%e6%9c%ac" aria-label="更改 WSL 版本">更改 WSL 版本</a></li>
                <li>
                    <a href="#%e5%a4%87%e4%bb%bd-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="备份 Linux 发行版">备份 Linux 发行版</a></li>
                <li>
                    <a href="#%e5%8d%b8%e8%bd%bd-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="卸载 Linux 发行版">卸载 Linux 发行版</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96-wsl-%e6%93%8d%e4%bd%9c" aria-label="其他 WSL 操作">其他 WSL 操作</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%ae%bf%e9%97%ae-linux-%e6%96%87%e4%bb%b6" aria-label="访问 Linux 文件">访问 Linux 文件</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%90%af-linux-%e5%8f%91%e8%a1%8c%e7%89%88" aria-label="自启 Linux 发行版">自启 Linux 发行版</a></li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9-root-%e5%af%86%e7%a0%81" aria-label="修改 root 密码">修改 root 密码</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="概述">概述<a hidden class="anchor" aria-hidden="true" href="#概述">#</a></h3>
<p>Windows Subsystem for Linux（WSL）全称适用于 Linux 的 Windows 子系统。</p>
<p>WSL 可以让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。详情参考：<a href="https://learn.microsoft.com/zh-cn/windows/wsl/">WSL 文档</a>。</p>
<h3 id="虚拟化技术">虚拟化技术<a hidden class="anchor" aria-hidden="true" href="#虚拟化技术">#</a></h3>
<p>WSL 依赖于虚拟化技术，需要在 Windows 功能中启用 Hyper-V 功能和虚拟机平台功能，请参考：<a href="../hyper-v-easy-gpu-pv/#%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF">虚拟化技术</a>。</p>
<h3 id="linux-发行版">Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#linux-发行版">#</a></h3>
<p>在 WSL 尚未安装任何 Linux 发行版的情况下，使用 Windows PowerShell 运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl
</span></span></code></pre></div><p>控制台将输出与 wsl.exe 程序相关的参数说明：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423181317618.png#center" alt="image-20230423181317618"  />
</p>
<p>该中文版说明中，会出现许多“分发”的字眼，这个翻译实际不准确的。英文文档中 distribution 在中文文档里不应该被翻译为“分发”，而应翻译为“发行版”。</p>
<p>Linux 发行版即 Linux Distribution，它也被称作 GNU/Linux 发行版。它是为一般用户预先集成好的 Linux 操作系统，用户不需要重新编译，直接安装发行版后，只需要小幅度更改设置即可使用。</p>
<p>Linux 发行版通常以软件包管理系统来进行应用软件的管理，一般的 Linux 发行版都会预先集成包括桌面环境、办公包、媒体播放器、数据库等应用软件（类比 Android 的预装应用）。</p>
<p>微软在许多需要说明命令用途的地方，将 distribution 译为“分发”，具有一定的迷惑性。因为在 Linux Distribution 等专有名词中，distribution 应该被翻译为“发行版”而非“分发”。</p>
<p>除此之外，Linux Distribution 也常被缩写为 Linux Distro，其中 distro 为 distribution 的缩写形式，它们都是“发行版”的意思。</p>
<p>可以将 Linux 发行版看作 Linux 系统的子集，或者说 Linux 发行版是 Linux 系统的具体解释。例如 CentOS 是 Linux 发行版，但同时它也是 Linux 系统。因此，从某种意义上来说，可将 Linux 发行版与 Linux 系统看作是同一个东西。</p>
<p>更多关于 Linux 发行版的资料，请参考：<a href="https://zh.wikipedia.org/wiki/Linux%E5%8F%91%E8%A1%8C%E7%89%88">Linux Distribution - WIKI</a>。</p>
<h3 id="关于终端命令">关于终端命令<a hidden class="anchor" aria-hidden="true" href="#关于终端命令">#</a></h3>
<p>后续涉及诸多 Windows PowerShell 命令，其中有一点注意事项，即为终端命令选项提供的参数，一般不能书写空格符号的。</p>
<p>如果参数包含空格符号，则需要用单引号或双引号将其包裹，或将空格符号转义。</p>
<p>假如在 H:\ 盘下拥有一个名为 proxy rules 的目录，以下演示不同命令进入该目录的方法。</p>
<p>CMD 命令书写如下（命令顺序不重要，但盘符切换不能使用 cd 命令）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>h:
</span></span><span style="display:flex;"><span>cd <span style="color:#e6db74">&#34;proxy rules&#34;</span>
</span></span></code></pre></div><p>PowerShell 命令书写如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd <span style="color:#e6db74">&#39;h:\proxy rules&#39;</span>
</span></span></code></pre></div><p>Bash 命令书写如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /h/proxy<span style="color:#ae81ff">\ </span>rules
</span></span><span style="display:flex;"><span><span style="color:#75715e">####### OR #######</span>
</span></span><span style="display:flex;"><span>cd <span style="color:#e6db74">&#39;/h/proxy rulse&#39;</span>
</span></span></code></pre></div><p>以上使用单引号的命令同时兼容使用双引号，但使用双引号的命令不兼容使用单引号。其次，对于不包含空格符号的参数来说，单引号或双引号可省略不写。</p>
<p>例如以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --install --distribution Ubuntu
</span></span></code></pre></div><p>等价以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --install --distribution <span style="color:#e6db74">&#39;Ubuntu&#39;</span>
</span></span></code></pre></div><p>如果是为了养成良好的编程习惯，那么不省略单引号或双引号是更好的方案。</p>
<h3 id="wsl">WSL<a hidden class="anchor" aria-hidden="true" href="#wsl">#</a></h3>
<p>对于大多数 Windows 10 或以上版本的系统来说，它们都已经默认支持 WSL 了，可以通过区分系统版本，来判断目前系统支持的 WSL 版本有什么。</p>
<p>不同版本的 WSL 并不是非此即彼的存在，同一个 Windows 系统可同时兼容 WLS 1 和 WSL2。</p>
<table>
<thead>
<tr>
<th style="text-align:left">功能</th>
<th style="text-align:left">WSL 1</th>
<th style="text-align:left">WSL 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows 和 Linux 之间的集成</td>
<td style="text-align:left">✅</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">启动时间短</td>
<td style="text-align:left">✅</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">与传统虚拟机相比，占用的资源量少</td>
<td style="text-align:left">✅</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">可以与当前版本的 VMware 和 VirtualBox 一起运行</td>
<td style="text-align:left">✅</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">托管 VM</td>
<td style="text-align:left">❌</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">完整的 Linux 内核</td>
<td style="text-align:left">❌</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">完全的系统调用兼容性</td>
<td style="text-align:left">❌</td>
<td style="text-align:left">✅</td>
</tr>
<tr>
<td style="text-align:left">跨 OS 文件系统的性能</td>
<td style="text-align:left">✅</td>
<td style="text-align:left">❌</td>
</tr>
</tbody>
</table>
<p>WSL 目前仅有 WSL1 和 WSL2 两个版本，就性能表现上推荐使用 WSL2。如果 Windows 系统版本号低于 18917 则表示当前系统只支持 WSL1，如果高于 18917 则表示系统同时支持 WSL1 和 WSL2。</p>
<p>查看系统版本信息，需要打开命令提示符 CMD 程序运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ver
</span></span></code></pre></div><p>使用 Windows PowerShell 则运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cmd <span style="color:#e6db74">&#39;ver&#39;</span>
</span></span></code></pre></div><p>当前系统的版本信息会输出在控制台中：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423074740531.png#center" alt="image-20230423074740531"  />
</p>
<p>上述例子中，版本号为 22621 就表示当前系统同时支持 WSL1 和 WSL2。</p>
<p>WSL 程序默认存储在 C:\Windows\System32 目录中：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423070627519.png#center" alt="image-20230423070627519"  />
</p>
<p>该程序的企鹅图标即为 Linux 的典型标志。</p>
<p>虽然 WSL 程序已存在于系统中，但实际尚未可用，直接调用往往只能看到一个一闪而过的终端窗口。</p>
<p>因为调用 wsl.exe 程序时，它需要间接启动当前默认的 Linux 发行版，显然系统尚未安装任何的 Linux 发行版，这意味着现在调用 wsl.exe 程序毫无用处。</p>
<p>一种更为浅显的理解，可以把 WSL 看作连接 Windows 系统和 Linux 系统的桥梁，即使用 WSL 可以在 Windows 上建立与 Linux 系统的高效连接。</p>
<p>显然，目前 Windows 系统和 WSL 程序都已准备妥当，唯一缺失的仅有 Linux 系统。</p>
<h4 id="使用-wsl2-版本">使用 WSL2 版本<a hidden class="anchor" aria-hidden="true" href="#使用-wsl2-版本">#</a></h4>
<p>安装 Linux 发行版前，需要确认安装发行版时所使用的 WSL 版本是什么。由于 WSL2 相较于 WSL1 拥有更好的虚拟性能，因此建议后续安装的 Linux 发行版均使用 WSL2。</p>
<p>遗憾的是，即便能够通过查询系统版本号的方式，确认系统是否支持 WSL2，但这却并不意味着支持 WSL2 的系统默认使用的 WSL 版本为 WSL2！</p>
<p>在无安装任何 Linux 发行版的情况下，WSL 亦无提供任何用于查询当前 WSL 版本的命令。因此推荐显式地运行设置版本为 WSL2 的命令，以确保后续安装的 Linux 发行版均使用 WSL2。</p>
<p>以下命令可以确保后续安装的 Linux 发行版均使用 WSL2：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --set-default-version <span style="color:#e6db74">&#39;2&#39;</span>
</span></span></code></pre></div><p>该命令只需要运行一次，后续默认安装或新安装的 Linux 发行版都会使用 WSL2。</p>
<h4 id="安装-linux-发行版">安装 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#安装-linux-发行版">#</a></h4>
<p>官方所说的“安装 WSL”并平常所理解安装，与其说“安装 WSL”倒不如说是“将指定的 Linux 发行版安装到本地”。一旦本地安装了 Linux 发行版，就能通过 WSL 访问并使用它。</p>
<p>以下命令会将默认的 Linux 发行版安装到本地：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --install
</span></span></code></pre></div><p>该命令实际等同于：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --install --distribution <span style="color:#e6db74">&#39;Ubuntu&#39;</span>
</span></span></code></pre></div><p>从命令的形式看，可以知道“默认的 Linux 发行版”就是“Ubuntu”发行版。通过修改 &ndash;distribution 选项的参数，可以安装其他的 Linux 发行版。</p>
<p>但 WSL 并非支持任意的 Linux 发行版，想要获取所有受支持的 Linux 发行版列表，需要使用命令行在线查询获取。</p>
<p>以下命令用于查询所有 WSL 支持安装的 Linux 发行版列表：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --list --online
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423072949672.png#center" alt="image-20230423072949672"  />
</p>
<p>需要注意，该命令本质是从网络上拉取列表。如果网络不佳，则可能出现错误提示：</p>
<p><img loading="lazy" src="../images/WSL.images/Snipaste_2023-04-23_04-31-27.png#center" alt="Snipaste_2023-04-23_04-31-27"  />
</p>
<p>其中 NAME 即为 --distribution 选项所能接受的参数，FRIDENDLY NAME 则为更加详解的版本名称，能够在列表中看到默认安装的“Ubuntu”发行版。</p>
<p>如果不希望使用默认的 Ubuntu 发行版，可以在安装时使用 --distrubution 或 -d 选项指定发行版的名称。例如安装 Ubuntu-22.04 发行版：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --install -d <span style="color:#e6db74">&#39;Ubuntu-22.04&#39;</span>
</span></span></code></pre></div><p>这个命令同时使用于安装其他的 Linux 发行版，这样可以将多个不同的 Linux 发行版安装到本地。</p>
<h4 id="查看-linux-发行版">查看 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#查看-linux-发行版">#</a></h4>
<p>以下命令用于查看所有已安装 Linux 发行版的信息：</p>
<ul>
<li>NAME 表示 Linux 发行版名称；</li>
<li>STATE 表示 Linux 发行版所处状态；</li>
<li>VERSION 表示 Linux 发行版使用的 WSL 版本。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --list --verbose
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423080316852.png#center" alt="image-20230423080316852"  />
</p>
<h4 id="默认-linux-发行版">默认 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#默认-linux-发行版">#</a></h4>
<p>查看 Linux 发行版信息时，不难留意到位于行首的 * 标志。它表示当前调用 wsl.exe 程序时，默认使用的 Linux 发行版是什么。</p>
<p>例如上述例子中，默认的 Linux 发行版为 Ubuntu-22.04，这意味着调用 wsl.exe 程序时，就会启动并使用 Ubuntu-22.04 发行版。</p>
<p>进入 wsl.exe 程序后，运行以下命令可以查询 Ubuntu 系统的版本号：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lsb_release -a
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423080934388.png#center" alt="image-20230423080934388"  />
</p>
<p>回到 PowerShell 中运行以下命令，可以更改默认启动的 Linux 发行版：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --set-default &lt;distrubution name&gt;
</span></span></code></pre></div><p>在上述例子中，需要运行命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wsl --set-default <span style="color:#e6db74">&#39;Ubuntu-20.04&#39;</span>
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423081402029.png#center" alt="image-20230423081402029"  />
</p>
<p>再次调用 wsl.exe 打开 Linux Bash 终端，并查询 Ubuntu 版本信息：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423081458738.png#center" alt="image-20230423081458738"  />
</p>
<p>可以看到发行版信息已改变，这意味着默认使用的 Linux 发行版确实改变了。</p>
<h4 id="更改-wsl-版本">更改 WSL 版本<a hidden class="anchor" aria-hidden="true" href="#更改-wsl-版本">#</a></h4>
<p>如果一开始并没有配置 WSL 默认版本，即没有运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --set-default-version <span style="color:#e6db74">&#39;2&#39;</span>
</span></span></code></pre></div><p>那么查看当前所有已安装的 Linux 发行版时，就可能出现 VERSION 为 1 的情况：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423083115568.png#center" alt="image-20230423083115568"  />
</p>
<p>示例中 Ubuntu-22.04 发行版使用的 WSL 版本为 WSL1，所幸这并非无可挽救。</p>
<p>以下命令用于更改当前已安装 Linux 发行版所使用 WSL 版本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --set-version &lt;distribution name&gt; &lt;versionNumber&gt;
</span></span></code></pre></div><p>在上述例子中，需要运行命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --set-version <span style="color:#e6db74">&#39;Ubuntu-22.04&#39;</span> <span style="color:#e6db74">&#39;2&#39;</span>
</span></span></code></pre></div><p>WSL 版本的转换需要一定的时间：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423083533520.png#center" alt="image-20230423083533520"  />
</p>
<p>转换完毕后，可查看到对应 Linux 发行版所使用的 WSL 版本已变更：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423083618536.png#center" alt="image-20230423083618536"  />
</p>
<h4 id="备份-linux-发行版">备份 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#备份-linux-发行版">#</a></h4>
<p>使用虚拟系统的最大优点，莫过于系统的可恢复性了。WSL 提供了方便的导入/导出发行版系统的命令，可随时将 Linux 发行版导出为 .tar 文件，或将 .tar 文件恢复成 Linux 发行版。</p>
<p>以下命令用于导出 Linux 发行版：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --export &lt;Distribution Name&gt; &lt;FileName&gt;
</span></span></code></pre></div><p>以下命令用于导入 Linux 发行版：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --import &lt;Distribution Name&gt; &lt;InstallLocation&gt; &lt;FileName&gt;
</span></span></code></pre></div><p>以 Ubuntu-22.04 为例，需要将它导出至系统磁盘，则运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --export <span style="color:#e6db74">&#39;Ubuntu-22.04&#39;</span> <span style="color:#e6db74">&#39;C:\Ubuntu-22.04.tar&#39;</span>
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423090510661.png#center" alt="image-20230423090510661"  />
</p>
<p>后续需要将 Ubuntu-22.04 重新导入 WSL 中，则运行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --import <span style="color:#e6db74">&#39;My-Ubuntu&#39;</span> <span style="color:#e6db74">&#39;I:\Virtual Machine&#39;</span> <span style="color:#e6db74">&#39;C:\Ubuntu-22.04.tar&#39;</span>
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423090906831.png#center" alt="image-20230423090906831"  />
</p>
<p>导入的 Linux 发行版会以导入时指定的发行版名称，出现在当前已安装的发行版列表中：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423091011589.png#center" alt="image-20230423091011589"  />
</p>
<h4 id="卸载-linux-发行版">卸载 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#卸载-linux-发行版">#</a></h4>
<p>假如不再需要使用某个 Linux 发行版，或需要删除当前的 Linux 发行版重新安装或导入其他的同名的发行版时，就需要使用到卸载或注销 Linux 发行版的命令。</p>
<p>以下命令用于卸载或注销指定名称的 Linux 发行版：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --unregister &lt;DistributionName&gt;
</span></span></code></pre></div><p>以 My-Ubuntu 发行版为例，卸载它需要运行命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --unregister <span style="color:#e6db74">&#39;My-Ubuntu&#39;</span>
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423091420664.png#center" alt="image-20230423091420664"  />
</p>
<p>卸载或注销操作会一并将相关的文件删除，不用担心文件冗余的情况。</p>
<h4 id="其他-wsl-操作">其他 WSL 操作<a hidden class="anchor" aria-hidden="true" href="#其他-wsl-操作">#</a></h4>
<p>以下命令用于更新 WSL：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --update
</span></span></code></pre></div><p>该命令有一个可选的 --web-download 选项，使用它表示更新会从 GitHub 下载，而不从 Microsoft Store 下载。</p>
<p>以下命令用于关闭 WSL：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --shutdown
</span></span></code></pre></div><p>该命令会立即终止所有正在运行的发行版和 WSL 2 轻量级实用工具虚拟机。</p>
<p>如果只需要终止指定的发行版或阻止其运行，可以使用以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --terminate &lt;distribution name&gt;
</span></span></code></pre></div><p>例如终止 Ubuntu-20.04 发行版的运行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --terminate <span style="color:#e6db74">&#39;Ubuntu-20.04&#39;</span>
</span></span></code></pre></div><p>实际上，退出 Linux Bash 之后对应的 Linux 发行版会自动停止运行。不过存在一种特殊的方法，使用该方法能让 Linux 发行版保存运行状态，并随系统启动而自动运行。</p>
<h3 id="访问-linux-文件">访问 Linux 文件<a hidden class="anchor" aria-hidden="true" href="#访问-linux-文件">#</a></h3>
<p>如果要从 Windows 访问 Linux 文件，可通过路径访问：</p>
<pre tabindex="0"><code>\\wsl$\&lt;distribution-name&gt;
</code></pre><p>以 Ubuntu-20.04 为例，需要访问 Linux 系统文件，则访问以下路径即可：</p>
<pre tabindex="0"><code>\\wsl$\Ubuntu-20.04
</code></pre><p><img loading="lazy" src="../images/WSL.images/image-20230423092829460.png#center" alt="image-20230423092829460"  />
</p>
<p>Linux 发行版的虚拟驱动器通常名为 ext4.vhdx 且被存储在 AppData 内相关的 WSL 目录中，这种虚拟驱动器通常可以被挂载。</p>
<p>不过官方不建议使用任何 Windows 工具或编辑器修改、移动或访问 AppData 目录中的 WSL 相关文件。使用路径访问 Linux 文件的方式，是官方所推荐的唯一访问形式。</p>
<p>但该形式存在一个问题，Linux 发行版在不使用时总是处于 Stopped 状态：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423093332898.png#center" alt="image-20230423093332898"  />
</p>
<p>如果目标发行版处于 Stopped 状态，那么访问该发行版的系统文件时，WSL 需先将该发行版启动，随后 Windows 系统才能到发行版文件。</p>
<p>换言之，如果目标 Linux 发行版尚未启动，那么直接访问目标 Linux 文件就会出现卡顿的情况。</p>
<h3 id="自启-linux-发行版">自启 Linux 发行版<a hidden class="anchor" aria-hidden="true" href="#自启-linux-发行版">#</a></h3>
<p>WSL 实则并未提供任何让 Linux 发行版随开机启动的放，但可以利用 Windows 系统访问 Linux 系统文件的特点，间接让指定的 Linux 发行版随开机启动。</p>
<p>将访问指定 Linux 发行版系统文件的链接，映射为网络驱动器：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423094012724.png#center" alt="image-20230423094012724"  />
</p>
<p>添加完毕后，电脑中会出现该 Linux 发行版的网络位置：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423094119486.png#center" alt="image-20230423094119486"  />
</p>
<p>使用命令行查看所有已安装 Linux 发行版的状态：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wsl --list --verbose
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423094208011.png#center" alt="image-20230423094208011"  />
</p>
<p>将看到 Ubuntu-22.04 发行版会一直处于 Running 状态。</p>
<p>由于重启计算机后，网络位置也会重新连接，则对应的 Linux 发行版需要启动后网络位置才能完成重新连接，自此间接达成了自启 Linux 发行版的目的。</p>
<h3 id="修改-root-密码">修改 root 密码<a hidden class="anchor" aria-hidden="true" href="#修改-root-密码">#</a></h3>
<p>默认情况下，安装 Linux 发行版后，系统内默认的 root 密码是随机的，这意味着每次开机都会有一个新的 root 密码。为便于使用，需要变更发行版 root 用户的密码为固定的。</p>
<p>进入 Linux Bash 中使用以下命令修改当前用于的密码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo passwd
</span></span></code></pre></div><p><img loading="lazy" src="../images/WSL.images/image-20230423084627936.png#center" alt="image-20230423084627936"  />
</p>
<p>修改完毕后，该密码即会作为 root 用户的新密码。</p>
<p>将用户切换为 root 使用以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>su root
</span></span></code></pre></div><p>显示当前用户名称，使用以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>whoami
</span></span></code></pre></div><p>测试 root 用户密码的可用性：</p>
<p><img loading="lazy" src="../images/WSL.images/image-20230423084836756.png#center" alt="image-20230423084836756"  />
</p>
<p>显然 root 用户密码已成功变更。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dylan127c.github.io/tags/windows-subsystem/">Windows Subsystem</a></li>
      <li><a href="https://dylan127c.github.io/tags/virtual-machine/">Virtual Machine</a></li>
      <li><a href="https://dylan127c.github.io/tags/linux/">Linux</a></li>
      <li><a href="https://dylan127c.github.io/tags/ubuntu/">Ubuntu</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://dylan127c.github.io/posts/bash-themes/">
    <span class="title">Next »</span>
    <br>
    <span>Bash Themes</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://dylan127c.github.io/">Think</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<script type="text/javascript" src="/js/lightgallery.min.js"></script>
<script type="text/javascript" src="/js/lg-zoom.min.js"></script>
<script type="text/javascript" src="/js/lg-thumbnail.min.js"></script>

<script>

    
    var imgElements = document.querySelectorAll(".post-content p>img");
    if (imgElements.length > 0) {
        for (var i = 0; i < imgElements.length; i++) {
            var pElement = imgElements[i].parentNode;
            var aElement = document.createElement("a");

            aElement.setAttribute("href", "javascript:void(0)");
            aElement.setAttribute("name", "thumbnail" + i);

            
            aElement.setAttribute("onclick", "activate(this.name)")

            aElement.innerHTML = pElement.innerHTML;
            pElement.parentNode.replaceChild(aElement, pElement);
        }
        
        function activate(id) {
            document.getElementById(id).click();
        }

        
        

        
        var divThumbnail = document.createElement("div");
        divThumbnail.setAttribute("id", "lightgallery");

        
        divThumbnail.style.display = "none";

        
        for (var i = 0; i < imgElements.length; i++) {
            var aElement = document.createElement("a");
            aElement.setAttribute("href", imgElements[i].getAttribute("src"));
            aElement.setAttribute("id", "thumbnail" + i);
            aElement.innerHTML = imgElements[i].outerHTML;
            divThumbnail.appendChild(aElement);
        }
        
        var bodyElement = document.getElementsByTagName("body")[0];
        bodyElement.append(divThumbnail);

        
        lightGallery(divThumbnail, {
            thumbnail: false,
            speed: 500,
            counter: false
        });
    }

    
    var aLinkElement = document.querySelectorAll(".post-content p a")
    for (var i = 0; i < aLinkElement.length; i++) {
        aLinkElement[i].setAttribute("target", "_blank");
    }
    
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
